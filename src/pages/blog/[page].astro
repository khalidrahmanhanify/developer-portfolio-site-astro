---
// Layout
import Layout from "@/layouts/Layout.astro";

// Types
import type { GetStaticPaths } from "astro";

// Helpers
import { render } from "astro:content";
import { getEntry } from "astro:content";
import { getCollection } from "astro:content";

// Components
import FormattedDate from "@/components/ui/FormattedDate.astro";
import Heading from "@/components/ui/Heading.astro";
import AuthorCard from "@/components/blog/AuthorCard.astro"


export const getStaticPaths = ( async() => {
    const posts = await getCollection("blog")
    return (posts.map((post) => ({
        params: {
            page: post.data.slug
        },
        props: {
            post
        }
    })));
}) satisfies GetStaticPaths;

const {post} = Astro.props
const {Content} = await render(post);
const {title, description, image, pubDate} = post.data
const author = await getEntry(post.data.author.collection, post.data.author.id);
---
<Layout {title} {description}>
    <section aria-label="Blog Metadata" class="blog-metadata">
        <header>
            <FormattedDate {pubDate} />
            <Heading tagName="h1" tagSize="h2">{title}</Heading>
            {author && <small>by {author.data.name }</small> }
            <p>{description}</p>
        </header>
        <img src={image.src} alt="">
    </section>
    <section aria-label="Blog Content" class="blog-content">
        <Content />
    </section>
    <AuthorCard />
</Layout>